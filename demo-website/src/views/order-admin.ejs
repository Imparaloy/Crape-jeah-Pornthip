<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Orders | Admin</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-[#FFF8F0] min-h-screen">

<%- include('components/navbar-admin', {
  activePath: (typeof activePath !== 'undefined' && activePath) ? activePath : '/orders',
  me: (typeof me !== 'undefined') ? me : null
}) %>

  <main class="max-w-6xl mx-auto py-6 px-4">
    <h1 class="text-3xl font-bold mb-2">Orders</h1>
    <div class="text-sm text-stone-700 mb-6 space-x-6">
      <span>Total : <%= counters?.total ?? 0 %></span>
      <span>In Process : <%= counters?.inProcess ?? 0 %></span>
      <span>Served : <%= counters?.served ?? 0 %></span>
    </div>

  <div class="flex items-center gap-3 mb-6">
    <a href="/orders?status=all"
       class="inline-flex items-center gap-2 px-4 py-2 rounded-lg border
              <%= activeTab==='all' ? 'bg-amber-200 border-amber-300' : 'bg-white border-stone-200' %>">
      <span class="text-sm font-semibold "><%= counters?.total ?? 0 %></span> All
    </a>
    <a href="/orders?status=in"
       class="inline-flex items-center gap-2 px-4 py-2 rounded-lg border
              <%= activeTab==='in' ? 'bg-amber-200 border-amber-300' : 'bg-white border-stone-200' %>">
      <span class="text-sm font-semibold"><%= counters?.inProcess ?? 0 %></span> In Process
    </a>
    <a href="/orders?status=served"
       class="inline-flex items-center gap-2 px-4 py-2 rounded-lg border
              <%= activeTab==='served' ? 'bg-amber-200 border-amber-300' : 'bg-white border-stone-200' %>">
      <span class="text-sm font-semibold"><%= counters?.served ?? 0 %></span> Served
    </a>
  </div>

    <div class="grid md:grid-cols-2 gap-6">
      <% if (orders && orders.length > 0) { %>
        <% orders.forEach((o, i) => { %>
        <div class="bg-[#FFFBF5] rounded-2xl border border-stone-200 p-6">
            <div class="flex items-center justify-between mb-4">
            <h2 class="text-xl font-semibold">Order #<%= i + 1 %></h2>

              <% if ((o.status ?? '') === 'Served') { %>
                <span class="inline-flex items-center gap-2 px-3 py-1 rounded-full bg-green-600 text-white text-sm">
                  <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/>
                  </svg>
                  Served
                </span>
              <% } else { %>
                <span class="inline-flex items-center gap-2 px-3 py-1 rounded-full bg-amber-500 text-white text-sm">
                  In Process
                </span>
              <% } %>
            </div>

            <div class="space-y-3 text-stone-800">
              <div class="flex items-center gap-2">
                <span class="inline-flex items-center gap-2 rounded-full text-black text-sm">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 -960 960 960"
                class="w-4 h-4"
                fill="gray">
                  <path d="M520-496v-144q0-17-11.5-28.5T480-680q-17 0-28.5 11.5T440-640v159q0 8 3 15.5t9 13.5l132 132q11 11 28 11t28-11q11-11 11-28t-11-28L520-496ZM480-80q-83 0-156-31.5T197-197q-54-54-85.5-127T80-480q0-83 31.5-156T197-763q54-54 127-85.5T480-880q83 0 156 31.5T763-763q54 54 85.5 127T880-480q0 83-31.5 156T763-197q-54 54-127 85.5T480-80Zm0-400Zm0 320q133 0 226.5-93.5T800-480q0-133-93.5-226.5T480-800q-133 0-226.5 93.5T160-480q0 133 93.5 226.5T480-160Z"/>
                </svg>
              </span>
                <span><%= o.time ?? '-' %></span>
              </div>
              <div class="flex items-center gap-2">
                <span class="inline-flex items-center gap-2 rounded-full text-black text-sm">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 -960 960 960"
                class="w-4 h-4"
                fill="gray">
                  <path d="M481-120q-17 0-28.5-11.5T441-160v-46q-45-10-79-35t-55-70q-7-14-.5-29.5T330-363q14-6 29 .5t23 21.5q17 30 43 45.5t64 15.5q41 0 69.5-18.5T587-356q0-35-22-55.5T463-458q-86-27-118-64.5T313-614q0-65 42-101t86-41v-44q0-17 11.5-28.5T481-840q17 0 28.5 11.5T521-800v44q38 6 66 24.5t46 45.5q9 13 3.5 29T614-634q-14 6-29 .5T557-653q-13-14-30.5-21.5T483-682q-44 0-67 19.5T393-614q0 33 30 52t104 40q69 20 104.5 63.5T667-358q0 71-42 108t-104 46v44q0 17-11.5 28.5T481-120Z"/>
                </svg>
              </span>
                <span><%= Number(o.price ?? 0).toFixed(2) %></span>
              </div>
              <div>
                <div class="font-semibold">Base</div>
                <div class="text-stone-700"><%= o.base ?? '-' %></div>
              </div>
              <div>
                <div class="font-semibold">Ingredients</div>
                <% if (o.detailsText && o.detailsText.trim() !== '') { %>
                  <div class="mt-1 rounded-lg bg-amber-50 border border-amber-200 text-amber-900 px-3 py-2 text-sm">
                    <%= o.detailsText %>
                  </div>
                <% } %>
                <% if (Array.isArray(o.toppingNames) && o.toppingNames.length) { %>
                  <div class="mt-2 flex flex-wrap gap-2">
                    <% o.toppingNames.forEach(function(t){ %>
                      <span class="inline-flex items-center rounded-full bg-white border border-stone-200 px-3 py-1 text-xs text-stone-700">
                        <%= t %>
                      </span>
                    <% }) %>
                  </div>
                <% } %>
                <% if ((!o.detailsText || o.detailsText.trim() === '') && (!o.toppingNames || o.toppingNames.length === 0)) { %>
                  <div class="text-stone-500">-</div>
                <% } %>
              </div>
            </div>

            <div class="mt-5">
              <% if ((o.status ?? '') !== 'In Process') { %>
                <button class="w-full rounded-xl border px-4 py-3 bg-amber-100 hover:bg-amber-200 js-update-status"
                        data-order-id="<%= o.id %>" data-current-ui="<%= o.status %>">
                  Mark as In Process
                </button>
              <% } else { %>
                <button class="w-full rounded-xl border px-4 py-3 bg-green-100 hover:bg-green-200 js-update-status"
                        data-order-id="<%= o.id %>" data-current-ui="<%= o.status %>">
                  Mark as Served
                </button>
              <% } %>
            </div>
          </div>
        <% }) %>
      <% } else { %>
        <p class="text-stone-500">No orders available.</p>
      <% } %>
    </div>
  </main>

  <script src="/js/orders-admin.js"></script>
</body>
</html>
